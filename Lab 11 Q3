#include <stdio.h>
#include <string.h>
#include <time.h>
#include <stdlib.h>

#define MAX_EMP 100

typedef struct {
    int day, month, year;
} Date;

typedef struct {
    int id;
    char name[50];
    char department[20];
    char designation[20];
    double salary;
    Date joiningDate;
    char phone[15];
    char email[50];
} Employee;

Employee employees[MAX_EMP];
int empCount = 0;

int calculateExperience(Date joinDate) {
    time_t t = time(NULL);
    struct tm tm_now = *localtime(&t);
    int years = tm_now.tm_year + 1900 - joinDate.year;
    if (tm_now.tm_mon + 1 < joinDate.month || 
        (tm_now.tm_mon + 1 == joinDate.month && tm_now.tm_mday < joinDate.day)) {
        years--;
    }
    return years;
}

void addEmployee() {
    Employee e;
    printf("Enter Employee ID: ");
    scanf("%d", &e.id);
    getchar();
    printf("Enter Name: ");
    fgets(e.name, sizeof(e.name), stdin);
    e.name[strcspn(e.name, "\n")] = '\0'; 

    printf("Enter Department (IT/HR/Finance/Marketing/Operations): ");
    scanf("%s", e.department);
    printf("Enter Designation (Intern/Junior/Senior/Manager/Director): ");
    scanf("%s", e.designation);
    printf("Enter Salary: ");
    scanf("%lf", &e.salary);
    printf("Enter Joining Date (dd mm yyyy): ");
    scanf("%d %d %d", &e.joiningDate.day, &e.joiningDate.month, &e.joiningDate.year);
    printf("Enter Phone Number: ");
    scanf("%s", e.phone);
    printf("Enter Email: ");
    scanf("%s", e.email);

    employees[empCount++] = e;
    printf("Employee added successfully!\n");
}

void displayEmployee(Employee e) {
    printf("\nID: %d\nName: %s\nDepartment: %s\nDesignation: %s\nSalary: %.2lf\n",
           e.id, e.name, e.department, e.designation, e.salary);
    printf("Joining Date: %02d-%02d-%04d\nPhone: %s\nEmail: %s\n",
           e.joiningDate.day, e.joiningDate.month, e.joiningDate.year, e.phone, e.email);
    printf("Experience: %d years\n", calculateExperience(e.joiningDate));
}

void displayAll() {
    if (empCount == 0) {
        printf("No employees to display.\n");
        return;
    }
    for (int i = 0; i < empCount; i++) {
        displayEmployee(employees[i]);
    }
}

void salaryStats() {
    char dept[20];
    printf("Enter Department for statistics: ");
    scanf("%s", dept);
    int count = 0;
    double sum = 0, max = 0, min = 1e9;
    for (int i = 0; i < empCount; i++) {
        if (strcmp(employees[i].department, dept) == 0) {
            double s = employees[i].salary;
            sum += s;
            if (s > max) max = s;
            if (s < min) min = s;
            count++;
        }
    }
    if (count == 0) {
        printf("No employees in %s department.\n", dept);
        return;
    }
    printf("\nDepartment: %s\nTotal Salary: %.2lf\nAverage Salary: %.2lf\nMax Salary: %.2lf\nMin Salary: %.2lf\n",
           dept, sum, sum / count, max, min);
}

void annualAppraisal() {
    for (int i = 0; i < empCount; i++) {
        int percent;
        printf("Enter performance increment %% for %s (5-15): ", employees[i].name);
        scanf("%d", &percent);
        if (percent < 5) percent = 5;
        if (percent > 15) percent = 15;
        employees[i].salary += employees[i].salary * percent / 100.0;
        printf("%s's new salary: %.2lf\n", employees[i].name, employees[i].salary);
    }
}

void searchEmployees() {
    int choice;
    printf("\nSearch by:\n1. Department\n2. Designation\n3. Experience >= years\nChoice: ");
    scanf("%d", &choice);
    if (choice == 1) {
        char dept[20];
        printf("Enter Department: ");
        scanf("%s", dept);
        for (int i = 0; i < empCount; i++) {
            if (strcmp(employees[i].department, dept) == 0)
                displayEmployee(employees[i]);
        }
    } else if (choice == 2) {
        char des[20];
        printf("Enter Designation: ");
        scanf("%s", des);
        for (int i = 0; i < empCount; i++) {
            if (strcmp(employees[i].designation, des) == 0)
                displayEmployee(employees[i]);
        }
    } else if (choice == 3) {
        int years;
        printf("Enter minimum experience in years: ");
        scanf("%d", &years);
        for (int i = 0; i < empCount; i++) {
            if (calculateExperience(employees[i].joiningDate) >= years)
                displayEmployee(employees[i]);
        }
    } else {
        printf("Invalid choice.\n");
    }
}

void promotionEligibility() {
    printf("\nEmployees eligible for promotion (>3 years in current role):\n");
    for (int i = 0; i < empCount; i++) {
        if (calculateExperience(employees[i].joiningDate) > 3) {
            displayEmployee(employees[i]);
        }
    }
}

int main() {
    int choice;
    while (1) {
        printf("\n---- Employee Management System ----\n");
        printf("1. Add Employee\n2. Display All Employees\n3. Department Salary Statistics\n");
        printf("4. Annual Appraisal\n5. Search Employees\n6. Promotion Eligibility\n7. Exit\nChoice: ");
        scanf("%d", &choice);
        switch (choice) {
            case 1: addEmployee(); break;
            case 2: displayAll(); break;
            case 3: salaryStats(); break;
            case 4: annualAppraisal(); break;
            case 5: searchEmployees(); break;
            case 6: promotionEligibility(); break;
            case 7: exit(0);
            default: printf("Invalid choice!\n");
        }
    }
    return 0;
}
